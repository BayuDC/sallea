const stopAnimBubble=e=>{e.addEventListener("animationend",e=>{e.stopPropagation()})},animToggle=(e,t,n)=>{if(e.classList.contains("active"))return t();n()},clickOnEnter=t=>{t?.addEventListener("keyup",e=>{"Enter"==e.key&&t.click()})},gallery=document.getElementById("gallery"),galleryResize=()=>{var e=gallery?.offsetWidth;gallery?.setAttribute("style",`column-count: ${Math.floor(e/300)}`)},errorPage=(e="Something Went Wrong")=>{gallery.id="error",gallery.innerHTML=`
        <h1>404</h1>
        <p>${e}</p>
    `},setLoadEvent=()=>{[...gallery.children].forEach(e=>{if("img"==e.getAttribute("class")){const n=e.children[0];var t=()=>{gallery.hasAttribute("class")&&(gallery.removeAttribute("class"),gallery.removeChild(gallery.firstElementChild)),e.removeAttribute("style"),gallery.appendChild(e)};if(n.complete)return t();n.addEventListener("load",t),n.addEventListener("error",()=>{e.parentElement==gallery&&(gallery.removeChild(e),1!=gallery.childElementCount||gallery.lastElementChild.classList.contains("img")||errorPage())})}})};galleryResize(),window.addEventListener("resize",galleryResize),gallery&&([...gallery.children].forEach(t=>{t.addEventListener("keyup",e=>{"Enter"==e.key&&t.children[1].click()})}),setLoadEvent());const btnRefresh=document.getElementById("btn-refresh");btnRefresh?.addEventListener("click",async()=>{btnRefresh.classList.add("click");var e=()=>{[...gallery.children].forEach(e=>{if("img"==e.getAttribute("class")){const t=e.children[0];t.src=""}})},t=`
        <div class="load-box">
        <span class="material-icons">circle</span>
        <span class="material-icons">circle</span>
        <span class="material-icons">circle</span>
        <span class="material-icons">circle</span>
        </div>`;e(),gallery.id="gallery",gallery.classList.add("load"),gallery.innerHTML=t;try{const n=await fetch(document.URL+"?type=json"),a=await n.json();if(!n.ok)return errorPage(a.msg);e(),gallery.id="gallery",gallery.innerHTML=a.reduce((e,t)=>e+`<div class="img" style="display: none" tabindex="0">
                    <img src="/i/${t}?width=320">
                    <a href="/f/${t}" class="btn btn-float btn-image" tabindex="-1">
                    <span class="material-icons-outlined">image</span>
                    </a>
                    <a href="/d/${t}" class="btn btn-float btn-download" tabindex="-1">
                    <span class="material-icons-outlined">file_download</span>
                    </a>
                </div>`,t),setLoadEvent()}catch{errorPage()}}),btnRefresh?.addEventListener("animationend",e=>{btnRefresh.classList.remove("click")}),clickOnEnter(btnRefresh);const btnMenu=document.getElementById("btn-menu"),menu=document.getElementById("menu");btnMenu?.addEventListener("click",()=>{animToggle(menu,()=>menu.classList.add("hide"),()=>menu.classList.add("show"))}),clickOnEnter(btnMenu),menu?.addEventListener("animationend",()=>{const e=t=>{[...menu.children].forEach(e=>{e.classList.contains("sub-item")||e.setAttribute("tabIndex",t)})};menu.classList.remove("show","hide"),animToggle(menu,()=>{menu.classList.remove("active"),e(-1)},()=>{menu.classList.add("active"),e(0)})}),menu&&[...menu.getElementsByTagName("a")].forEach(t=>{t.addEventListener("click",e=>{gallery&&(e.preventDefault(),t.href!=document.URL&&(window.history.pushState({},"",t.href),btnRefresh?.click(),document.body.offsetWidth<=768&&btnMenu?.click()))})});const subMenus=document.getElementsByClassName("sub-menu");[...subMenus].forEach(n=>{const a=n.nextElementSibling,s=n.children[0];n.addEventListener("click",()=>{animToggle(n,()=>{a.classList.add("hide"),s.classList.add("end")},()=>{a.classList.add("show"),s.classList.add("start")})}),clickOnEnter(n),n.addEventListener("animationend",e=>{const t=t=>[...a.children].forEach(e=>e.setAttribute("tabIndex",t));s.classList.remove("start","end"),a.classList.remove("show","hide"),animToggle(n,()=>{a.classList.remove("active"),n.classList.remove("active"),t(-1)},()=>{a.classList.add("active"),n.classList.add("active"),t(0)})}),stopAnimBubble(n),stopAnimBubble(a)});